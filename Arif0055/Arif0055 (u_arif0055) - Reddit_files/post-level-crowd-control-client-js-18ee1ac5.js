import{a as t,E as e,o as s,c2 as l,r as a,G as i,c as o,J as d,O as r,b as n,u,v as c,t as h,_ as p,g as m,H as v,e as b}from"./shell-c6dfa469.js";import{x as w,y as f,I as C,s as y}from"./icon-5ce37e54.js";import{a6 as S}from"./age-gate-standalone-client-js-cd633927.js";import{O as x}from"./custom-event-a97037f1.js";import"./chat-mobile-xpromo-client-js-34b8f6a1.js";let I=class extends(t(y)){constructor(){super(...arguments),this.isLoading=!0,this.isSubmittable=!1,this.postId="",this._windowEvents=new e(this,(()=>window)),this.handleOpenModalEvent=this._windowEvents.define(x,(async t=>{this.isSubmittable=!1,this.isLoading=!0,this.showModal(),await this.activateFormContentFeature(t.detail.postId),this.postId=t.detail.postId,this.isLoading=!1}))}get oldPostLevel(){return this.querySelector('[name="old-post-level"]')?.value}get oldIsFilterEnabled(){return"true"===this.querySelector('[name="old-is-filter-enabled"]')?.value}activateFormContentFeature(t){return s({name:l,routeParams:{postId:t},renderMode:a.Contents})}showModal(){this.modal?.showModal()}closeModal(){this.modal?.close()}buildAlert(t){const e=t?i.success:i.error;return this.dispatchEvent(o("faceplate-alert",{level:e,message:S(t)}))}async onSave(){const t=this.querySelector('[name="post-level"][checked]'),e=this.querySelector('[name="is-filter-enabled"]');t?.value&&e?(this.submitRequest(t.value,null!=e.value),this.emitV2Event(t.value,null!=e.value)):(this.buildAlert(!1),this.isSubmittable=!0)}async submitRequest(t,e){try{this.isSubmittable=!1;const s=await this.invokeGQL(t,e);this.inspectResp(s)}catch(t){this.buildAlert(!1),this.isSubmittable=!0}}invokeGQL(t,e){return d({operation:r.UpdatePostLevelCrowdControlSettings,variables:{id:this.postId,level:t,filterIsEnabled:e,shouldIncludeUpdatePostCrowdControlFilter:e!==this.oldIsFilterEnabled,shouldIncludeUpdatePostCrowdControlLevel:t!==this.oldPostLevel}})}inspectResp(t){let e=!1;"updatePostCrowdControlFilter"in t.data&&"updatePostCrowdControlLevel"in t.data?t.data.updatePostCrowdControlFilter?.ok&&t.data.updatePostCrowdControlLevel?.ok&&(e=!0):"updatePostCrowdControlFilter"in t.data?t.data.updatePostCrowdControlFilter?.ok&&(e=!0):"updatePostCrowdControlLevel"in t.data&&t.data.updatePostCrowdControlLevel?.ok&&(e=!0),e?(this.buildAlert(!0),this.closeModal()):(this.buildAlert(!1),this.isSubmittable=!0)}isContentLoading(){return this.isLoading}emitV2Event(t,e){const s=this.querySelector('[name="subreddit-id"]'),l=this.querySelector('[name="subreddit-name"]'),a={id:s?.value||"",name:l?.value||""},i=this.querySelector('[name="author-id"]'),o={id:this.postId,author:{id:i?.value||""}};this.buildAndTrack("crowd_control_individual_post",o,a,{value:t,old_value:`${this.oldPostLevel}`}),this.buildAndTrack("crowd_control_individual_post_filter",o,a,{value:`${e}`,old_value:`${this.oldIsFilterEnabled}`})}buildAndTrack(t,e,s,l){const a=n({source:"post_mod_action_menu",action:"save",noun:t},{post:e,subreddit:s,setting:l});this.trackEvent(a)}handleInput(){this.isSubmittable=!0}render(){return w` <faceplate-modal inFocusTrap class="max-w-md w-full"> <div slot="title"> Adjust post crowd control </div> <div slot="closeButton"> ${u({appearance:"secondary",leadingIcon:f({size:C.Small}),size:c.Small,attributes:{type:"button",onclick:this.closeModal}})} </div> ${this.isLoading?w`<div class="w-full"> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-full h-3xl"></faceplate-shimmer> <faceplate-shimmer shape="pill" class="mt-xs mb-xs w-2/3 h-lg"></faceplate-shimmer> </div>`:w`<slot @input="${this.handleInput}"></slot>`} <div slot="primaryButton"> ${u({children:"Save",appearance:"primary",attributes:{type:"submit",onclick:this.onSave,disabled:!this.isSubmittable}})} </div> <div slot="secondaryButton"> ${u({children:"Cancel",appearance:"plain",attributes:{type:"button",onclick:this.closeModal}})} </div> </faceplate-modal> `}};I.styles=[h],p([m()],I.prototype,"isLoading",void 0),p([m()],I.prototype,"isSubmittable",void 0),p([m()],I.prototype,"postId",void 0),p([v("faceplate-modal")],I.prototype,"modal",void 0),I=p([b("post-level-crowd-control-modal")],I);
