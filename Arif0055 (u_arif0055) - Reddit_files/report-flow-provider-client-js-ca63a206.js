import{_ as t,n as e,H as r,e as s,P as o,o as i,cB as a,r as n,R as l,cC as p,T as c,cD as d,c as h,J as u,G as m}from"./shell-c6dfa469.js";import"./report-flow-client-js-3f799096.js";import{ah as b}from"./age-gate-standalone-client-js-cd633927.js";import"./community-onboarding-completed-modal-client-js-ab917ec7.js";import{s as g,x as w}from"./icon-5ce37e54.js";import{g as y,c as C,a as k,b as j}from"./submit-report-helper-25b14c87.js";import{F as R}from"./types-ef7c0612.js";import"./chat-mobile-xpromo-client-js-34b8f6a1.js";import"./app-selector-client-js-1b454bf5.js";import"./helpers-90efd9f3.js";import"./constants-b1a52852.js";import"./filterNullish-48b417d6.js";import"./promote-post-actions-controller-df3244ab.js";import"./utils-69251401.js";import"./faceplate-radio-input-43a5808f.js";import"./validate-image-cdf72f61.js";import"./text-input-6aea591c.js";import"./shreddit-slotter-3507e9e2.js";import"./zendesk-step-helper-a4df236d.js";import"./render-saved-response-template-by-subreddit-id-69204cc7.js";import"./faceplate-textarea-input-fdd1f435.js";import"./index-be299d4e.js";import"./index-6053883b.js";import"./hui-user-drawer-client-js-b156b2df.js";import"./TinyGesture-89d9957c.js";let f=class extends g{get rplDialogSheet(){return this.querySelector("rpl-dialog-sheet")}get featureRoot(){return document.querySelector("#report-flow-content-modal rpl-modal-card")}constructor(){super(),this.pubsub=new o(this),this._activateFeature=async t=>i(t),this.initReportFlow=async({thingId:t,authorName:e,authorId:r,flowType:s,triggerElement:o,permalink:i,onCloseCallback:c})=>{this.triggerElement=o,this.onCloseCallback=c;const d=t.startsWith("ad_"),h=s===l.UserDetails,u=s===l.Modmail;d||h||u?await this._activateFeature({name:p,routeParams:{thing_id:t,author_name:e||b(),is_desktop:this.isDesktop?"is-desktop":"is-not-desktop",author_id:r,flow_type:s??l.InlineContent},queryParams:{permalink:i??""},renderMode:n.Contents}):(await(this.rplDialogSheet?.showModal()),await this._activateFeature({name:a,renderMode:n.Contents,root:this.featureRoot,queryParams:{is_desktop:!!this.isDesktop,thing_id:t,flow_type:s??l.InlineContent,permalink:i??""}}))},this.closeFlexibleReportFlow=async()=>{await(this.rplDialogSheet?.hide()),this.triggerElement&&this.triggerElement.focus()},this.closeReportFlow=async()=>{await(this.reportFlow?.updateComplete),this.triggerElement&&this.triggerElement.focus()},this.hideReportedAd=async()=>{await(this.reportFlow?.updateComplete),this.onCloseCallback?.()},this.addEventListener("report-flow-close",this.closeReportFlow),this.addEventListener("submit-report-modal",this.hideReportedAd)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(c.ReportFlowInit,this.initReportFlow,!1),this.pubsub.subscribe(c.ReportFlowClose,this.closeFlexibleReportFlow,!1)}disconnectedCallback(){this.pubsub.unsubscribe(c.ReportFlowInit,this.initReportFlow),this.pubsub.unsubscribe(c.ReportFlowClose,this.closeFlexibleReportFlow),super.disconnectedCallback()}render(){return w`<slot></slot>`}};t([e({type:Boolean,attribute:"is-desktop"})],f.prototype,"isDesktop",void 0),t([r("report-flow")],f.prototype,"reportFlow",void 0),f=t([s("report-flow-provider")],f);let v=class extends g{constructor(){super(...arguments),this.pubsub=new o(this),this._activateFeature=async t=>i(t),this.openCTL=async({authorName:t,thingId:e,userDetailType:r})=>{const s=r?{userDetailType:r}:void 0;await this._activateFeature({name:d,renderMode:n.Contents,routeParams:{authorName:t,thingId:e},queryParams:{...s}})}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(c.CTLReportInit,this.openCTL,!1)}disconnectedCallback(){this.pubsub.unsubscribe(c.CTLReportInit,this.openCTL),super.disconnectedCallback()}render(){return w`<slot></slot>`}};v=t([s("ctl-reporting-provider")],v);let E=class extends g{constructor(){super(...arguments),this.closeCTLModal=()=>{this.ctlModal?.hide(),this.dispatchEvent(h("report-flow-close"))}}get ctlModal(){return document.querySelector("rpl-dialog#ctl-report-content-modal")}get ctlModalContents(){return document.querySelector("#ctl-report-content-modal rpl-modal-card")}};E=t([s("base-ctl-component")],E);let F=class extends E{constructor(){super(...arguments),this.requestClientGQL=u,this.showThankYou=()=>{const t=h("shreddit-slotter-set-slot-name",{slotName:"thankyou"});this.ctlModalContents?.querySelector("shreddit-slotter")?.dispatchEvent(t)},this.reportRequest=async(t,e)=>{const r=y[t];if(!r)throw new Error("No corresponding gql operation for the item type provided");try{const t=await this.requestClientGQL({operation:r,variables:{input:e}});return C(t)?t:void 0}catch(t){throw new Error("Error calling the gql report operation")}},this.submitCTLReport=async()=>{if(!this.thingId)return;const t=k(this.thingId);try{const e=j(t,this.thingId,{REPORT_REASONS:"SELF_HARM",...this.userDetailType?{USER_DETAILS:this.userDetailType}:{}});if(!await this.reportRequest(t,e))throw new Error;this.showThankYou(),this.dispatchEvent(h("report-tracking",{reportFlow:{flowOptionSelected:R.REDDITCARES_BUTTON}}))}catch(t){this.dispatchEvent(h("faceplate-alert",{level:m.error,cause:"uncategorized",message:"An error occurred while submitting your report. Wait a bit, and try again."}))}},this.firstUpdated=()=>{const t=this.querySelector("#ctl-yes-button");t?.addEventListener("click",this.submitCTLReport)}}render(){return w`<slot></slot>`}};t([e({type:String,attribute:"author-name"})],F.prototype,"authorName",void 0),t([e({type:String,attribute:"thing-id"})],F.prototype,"thingId",void 0),t([e({type:String,attribute:"user-detail-type"})],F.prototype,"userDetailType",void 0),F=t([s("ctl-step-one")],F);let T=class extends E{constructor(){super(...arguments),this.firstUpdated=()=>{this.okButton?.addEventListener("click",this.closeCTLModal)}}get okButton(){return this.querySelector("#ctl-ok-button")}render(){return w`<slot></slot>`}};T=t([s("ctl-step-two")],T);
