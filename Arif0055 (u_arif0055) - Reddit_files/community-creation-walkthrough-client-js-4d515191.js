import{u as t,S as e,a as i,d as s,b as a,U as n,e as o,f as d,t as r,g as h,h as l,n as c,i as u,j as p}from"./community-creation-walkthrough-fragment-client-js-4d3bd4b8.js";import{t as g,_ as m,n as v,u as b,v as y,e as f,a as x,g as w,E as S,G as $,c as T,J as C,O as k,j as I,I as N,eX as E}from"./shell-c6dfa469.js";import{a as R}from"./faceplate-textarea-input-fdd1f435.js";import{s as z,x as j,z as B,I as A,A as L,l as q,M as H,aj as P,bw as U,a as W,cl as D,f as M,a8 as _,cm as F}from"./icon-5ce37e54.js";import{T as O}from"./validate-image-cdf72f61.js";import"./faceplate-form-3f273b3d.js";import{bX as V,o as X,ac as Y,bY as Z}from"./age-gate-standalone-client-js-cd633927.js";import"./shop-gallery-data-fetcher-client-js-231ccd6c.js";import"./faceplate-search-input-25922144.js";import{l as K,L as G}from"./list-item-header-b6f6e197.js";import"./faceplate-radio-input-43a5808f.js";import"./index-be299d4e.js";import"./faceplate-tooltip-fee9b43c.js";import"./community-image-upload-9fefac39.js";import"./emoji-template-table-client-js-fe50fc5b.js";import"./chat-mobile-xpromo-client-js-34b8f6a1.js";import"./text-input-6aea591c.js";import"./filterNullish-48b417d6.js";import"./constants-b1a52852.js";import"./utils-69251401.js";import"./helpers-90efd9f3.js";import"./user-flair-12bd75e0.js";const J=j`<span class="text-12 text-neutral-content-weak mx-2xs">\u00B7</span>`;let Q=class extends z{constructor(){super(...arguments),this.name="",this.description="",this.shouldShowDefaultImages=!1}renderPublicDescriptionText(){return j`<p class="m-0 text-ellipsis mb-2xs"> ${0===this.description.length?"Your community description":this.description} </p>`}renderActiveAndTotalSubscribers(){const t=j`<span><faceplate-number number="1" pretty></faceplate-number> online</span>`;return j` <div class="text-12 text-neutral-content-weak"> <span>${V(j,1,!0)}</span>${J}${t} </div> `}renderTitleLink(){const t=j`<span class="block font-semibold text-20 text-neutral-content-strong hover:text-neutral-content-strong hover:no-underline pb-2xs">r/${0===this.name.length?"communityname":this.name}</span>`;return j`${t}`}renderSubredditIcon(){return void 0===this.avatar||""===this.avatar?X({children:b({appearance:"brand",leadingIcon:B({size:A.XXLarge}),size:y.Large,attributes:{tabindex:"-1","aria-hidden":"true"}}),attributes:{tabindex:"-1","aria-hidden":"true"},appearance:"icon",size:"lg"}):j`<img loading="lazy" width="42" height="42" class="rounded-[50%] overflow-hidden border-[0.5px] border-solid" src="${this.avatar}" alt="An avatar for the subreddit">`}render(){return j`<div class="flex rounded shadow-sm xs:rounded-4 flex-col relative max-w-[268px] grow max-h-[350px] overflow-auto"> ${this.shouldShowDefaultImages||this.banner?this.banner?j`<div class="w-100"> <img class="max-w-[100%] w-100 object-cover max-h-[40px] rounded-t-[12px]" src="${this.banner}" alt="Banner"> </div>`:j`<div class="w-100 bg-orangered-50 min-h-[32px] max-h-[40px]"></div>`:L} <div class="flex justify-start gap-x-md m-md mb-0"> ${this.avatar||this.shouldShowDefaultImages?j`<span class="block mt-2xs">${this.renderSubredditIcon()}</span>`:L} <div class="flex-col flex justify-center"> ${this.renderTitleLink()} <div>${this.renderActiveAndTotalSubscribers()}</div> </div> </div> <div class="p-sm pt-xs">${this.renderPublicDescriptionText()}</div> </div>`}};Q.styles=[g],m([v({type:String})],Q.prototype,"name",void 0),m([v({type:String})],Q.prototype,"description",void 0),m([v({type:String})],Q.prototype,"avatar",void 0),m([v({type:String})],Q.prototype,"banner",void 0),m([v({type:Boolean,attribute:"show-default-images"})],Q.prototype,"shouldShowDefaultImages",void 0),Q=m([f("community-creation-preview")],Q);const tt=new RegExp("^[A-Za-z0-9][A-Za-z0-9_]{0,20}$"),et=(t,e)=>I({one:`${t} of ${e} character`,other:`${t} of ${e} characters`,count:e}),it=x(z);let st=class extends it{constructor(){super(...arguments),this.events=new S(this,(()=>window)),this.subreddit={name:"",description:""},this.nameTaken=!1,this.validCharsName=!0,this.descriptionTooLong=!1,this.prefixText="",this.handleNameChange=e=>{const i=e.target.value.trim();this.nameInput.value=i,this.subreddit=t(this.subreddit,{name:i}),this.prefixText=""!==i?"r/":"",this.validCharsName=tt.test(i)||""===i,this.nameTaken&&this.validateNameTaken(),this.nameInputHelperText?.setMessage(this.getNameHelperText(),$.error),this.nameInputHelperText?.requestUpdate()},this.handleDescriptionChange=e=>{const i=e.target.value;this.descriptionInput?.setCustomValidity(""),this.descriptionInputHelperText?.setMessage(""),this.subreddit=t(this.subreddit,{description:i}),this.descriptionTooLong=i.length>500,this.descriptionTooLong&&this.setDescriptionTooLong()}}get submitButton(){return this.querySelector('button[type="submit"]')}get nameInput(){return this.shadowRoot?.querySelector('faceplate-text-input[name="name"]')}get descriptionInput(){return this.shadowRoot?.querySelector("faceplate-textarea-input")}get nameInputHelperText(){return this.nameInput?.shadowRoot?.querySelector('faceplate-form-helper-text[name="name"]')}get descriptionInputHelperText(){return this.descriptionInput?.shadowRoot?.querySelector('faceplate-form-helper-text[name="description"]')}async firstUpdated(){await this.updateComplete,this.querySelector("faceplate-pagination-indicator")?.shadowRoot?.querySelectorAll("button.dot").forEach((t=>{t.tabIndex=-1,t.ariaHidden="true"})),this.dispatchEvent(T("refresh_focus",{title:"Tell us about your community",ariaLabel:"Tell us about your community. "+e(1)})),this.events.define(i,(async t=>{t.stopPropagation(),await this.validateNameTaken(),this.formValid()&&(this.trackEvent(s(this.subreddit.description?.length||0)),this.dispatchSubredditUpdatedEvent("next"))})),this.events.define(a,(async t=>{t.stopPropagation(),this.dispatchSubredditUpdatedEvent("back")}))}update(t){this.validateNextButtonDisabled(),super.update(t)}dispatchSubredditUpdatedEvent(t){const e=new CustomEvent(n,{bubbles:!0,composed:!0,detail:{subreddit:this.subreddit,direction:t,source:o.NameAndDescription}});this.dispatchEvent(e)}dispatchErrors(t){const e=T("faceplate-alert",{level:$.error,cause:"uncategorized",message:t});this.dispatchEvent(e)}async validateNameTaken(){if(this.nameTaken||this.nameInput&&this.nameInput.checkValidity()){try{if(null===(await C({operation:k.CommunityName,variables:{subredditName:this.subreddit.name||""}})).data.subreddit)return this.nameTaken=!1,void this.resetNameInputValidation();this.trackEvent(d({reason:"Name already taken",setting_value:this.subreddit.name})),this.setNameInputTakenValidationMessage()}catch(t){this.dispatchErrors("Server error. Try again later. ")}this.nameTaken=!0}}setNameInputTakenValidationMessage(){this.nameInput?.setCustomValidity("invalid"),this.nameInputHelperText?.setMessage(`"r/${this.subreddit.name}" is already taken`,$.error),this.nameInput?.setCustomValidity("invalid")}setDescriptionTooLong(){this.descriptionInputHelperText?.setMessage("Description is too long.",$.error),this.descriptionInput?.setCustomValidity("invalid")}resetNameInputValidation(){this.nameInput.setCustomValidity(""),this.nameInputHelperText?.setMessage("")}getNameHelperText(){return this.validCharsName?3>this.subreddit.name.length?"Please lengthen this text to 3 characters or more":"":"Only letters, numbers and underscore are allowed"}formValid(){return null!==this.subreddit.name&&this.subreddit.name.length>=3&&this.subreddit.name.length<=21&&null!==this.subreddit.description&&this.subreddit.description.length>=1&&this.subreddit.description.length<=500&&!this.nameTaken&&this.validCharsName}validateNextButtonDisabled(){this.submitButton.disabled=!this.formValid()}render(){return j` <div class="xs:w-[752px] h-16 pr-12 py-2.5 rounded-2xl justify-start items-center pb-xl inline-flex"> <div class="grow shrink basis-0 flex-col justify-center items-start gap-[4px] inline-flex"> <div class="self-stretch text-sm font-normal text-tone-2 leading-tight">${"A name and description help people understand what your community is all about."}</div> </div> </div> <div class="mb-0"> <div class="flex gap-md flex-col-reverse flow xs:flex-row"> <div class="min-w-[55%]"> <faceplate-form class="w-100" validation-trigger="change"> <faceplate-text-input data-testid="name-input" class="block flex-1 pb-sm pt-sm" type="text" name="name" helper-text-message="${this.getNameHelperText()}" pattern="^[A-Za-z0-9][A-Za-z0-9_]{2,20}$" maxLength="21" value="${q(this.subreddit.name)}" required @input="${this.handleNameChange}" novalidate appearance="${R.SECONDARY}" prefix="${q(this.prefixText)}" @focusout="${this.validateNameTaken}" character-count character-count-aria-label="${et(this.subreddit.name.length,21)}" helper-text-screen-reader-msg="Character count limit reached"> <span slot="label"> ${"Community name"} </span> </faceplate-text-input> </faceplate-form> <faceplate-textarea-input size="expanded" appearance="${R.SECONDARY}" @input="${this.handleDescriptionChange}" value="${q(this.subreddit.description)}" name="description" required novalidate helper-text-message="${"Please shorten this text to 500 characters or less"}" rows="8" class="min-w-full xs:pb-lg" character-count character-count-aria-label="${et(this.subreddit.description.length,500)}"><span slot="label">${"Description"}</span> </faceplate-textarea-input> </div> <div class="flex items-start grow"> <community-creation-preview class="w-100 flex justify-center" name="${q(this.subreddit.name)}" description="${q(this.subreddit.description)}"></community-creation-preview> </div> </div> <div class="mb-0 pt-[42px]"> <slot name="buttons-bar"></slot> </div> </div> `}};st.styles=[g],m([w()],st.prototype,"subreddit",void 0),m([w()],st.prototype,"nameTaken",void 0),m([w()],st.prototype,"validCharsName",void 0),m([w()],st.prototype,"descriptionTooLong",void 0),st=m([f("community-creation-name-description")],st);const at=new Set(["tx1_20v2840","tx1_15teiqi","tx1_2b40g1a","tx1_14gsvq1","tx1_18c3qbq","tx1_12l080p","tx1_1nlg6jt","tx1_192ms0u","tx1_1ri658n"]),nt=3,ot=x(z);let dt=class extends ot{constructor(){super(...arguments),this.events=new S(this,(()=>window)),this.subreddit={topics:[]},this.selectedTopics=[],this.topics=new Array,this._loading=!1,this.maxTopicsSelected=!1,this.gqlTopics=new Array,this.filter="",this.removeSelected=t=>{this.maxTopicsSelected=!1,this.selectedTopics=this.selectedTopics.filter((e=>e!==t))},this.onTopicsClick=(t,e)=>{this.maxTopicsSelected=!1,t?this.selectedTopics.length<nt?(this.selectedTopics.push(e),this.requestUpdate()):this.maxTopicsSelected=!0:this.selectedTopics=this.selectedTopics.filter((t=>t!==e))},this.handleFilterChange=t=>{const e=t.target.value;this.filter=e,this.topics=this.gqlTopics.flatMap((t=>{if(t.displayName.toLowerCase().indexOf(e.toLowerCase())>-1)return[{...t,children:t.children}];{const i=t.children?t.children.filter((t=>t.displayName.toLowerCase().indexOf(e.toLowerCase())>-1)):[];return i.length>0?{...t,children:i}:[]}}))}}get topicsContainer(){return this.shadowRoot.querySelector("#topics")}get submitButton(){return this.querySelector('button[type="submit"]')}async firstUpdated(){this.loadTopics(),await this.updateComplete,this.querySelector("faceplate-pagination-indicator")?.shadowRoot?.querySelectorAll("button.dot").forEach((t=>{t.tabIndex=-1,t.ariaHidden="true"})),this.dispatchEvent(T("refresh_focus",{title:"Add topics",ariaLabel:"Add topics. "+e(3)})),this.events.define(i,(async t=>{t.stopPropagation(),this.submitButtonEnabled()&&(this.trackEvent(r(this.subreddit.topics.map((t=>t.displayName)),this.subreddit.topics.map((t=>t.id)))),this.dispatchSubredditUpdatedEvent("next"))})),this.events.define(a,(async t=>{t.stopPropagation(),this.dispatchSubredditUpdatedEvent("back")}))}dispatchSubredditUpdatedEvent(t){const e=new CustomEvent(n,{bubbles:!0,composed:!0,detail:{subreddit:{topics:this.filterSelected(this.gqlTopics)},direction:t,source:o.Topics}});this.dispatchEvent(e)}update(t){this.enableSubmitButtonIfValid(),t.has("subreddit")&&(this.selectedTopics=this.subreddit.topics?.map((t=>t.id))||[]),super.update(t)}filterSelected(t){let e=new Array;return t.forEach((t=>{this.selectedTopics.includes(t.id)&&e.push(t);const i=t.children?this.filterSelected(t.children):[];i.length>0&&(e=e.concat(i))})),e}async loadTopics(){this._loading=!0;const t=await C({operation:k.TaxonomyTopicsInfo});this._loading=!1;const e=t.data?.taxonomyInfo?.topics;if(e)e.sort(((t,e)=>{const i=at.has(t.id),s=at.has(e.id);return i&&!s?1:!i&&s?-1:t.displayName.localeCompare(e.displayName)})),this.gqlTopics=e,this.topics=this.gqlTopics;else{const t="There was an error fetching topics. Please try again later.",e=T("faceplate-alert",{level:$.error,cause:"uncategorized",message:t});this.dispatchEvent(e)}}dispatchWarningEvent(t,e,i){const s=new CustomEvent(h,{bubbles:!0,composed:!0,detail:{title:t,message:e,secondaryButton:i}});this.dispatchEvent(s)}submitButtonEnabled(){return this.selectedTopics.length>0&&this.selectedTopics.length<=nt}enableSubmitButtonIfValid(){this.submitButton.disabled=!this.submitButtonEnabled()}renderTopics(){return 0===this.topics.length?j`<div> ${Y({attributes:{type:"button"},children:j`<span class="flex"><span class="select-none text-12 font-semibold">No topics match your search </span></span>`,leadingIcon:H()})} </div>`:j`<div id="topics" class="flex flex-col gap-lg h-[250px] xs:h-[330px] overflow-x-hidden overflow-y-scroll"> ${this.topics.map((t=>this.renderTopic(t)),this)} </div>`}renderTopic({children:t,displayName:e,icon:i}){return j` <fieldset aria-labelledby="title-${e}" class="topic-section p-0 m-0 border-0"> <legend> <h3 class="my-0 text-14">${i}<span class="ml-2xs">${e}</span></h3> </legend> ${t?j`<div class="flex flex-wrap gap-x-2xs gap-y-xs mt-2xs"> ${t.map((t=>this.renderTopicContainer(t,this.selectedTopics.indexOf(t.id)>-1)))} </div>`:L} </fieldset> `}renderTopicContainer(t,e){const i=()=>{this.onTopicsClick(!e,t.id)};return j` <div class="topic-container" id="container_${t.id}" data-topic="${t.displayName}"> <label for="${t.id}" class="group"> ${Y({selected:e,attributes:{id:t.id,type:"button","aria-pressed":e?"true":"false",onclick:i},deleteButtonConfig:{screenReaderContent:`Deselect topic ${t.displayName}`,attributes:{onclick:t=>{t.preventDefault(),t.stopPropagation(),i()},type:"button",id:`unselect-${t.id}`}},children:j`<span class="select-none text-12 font-semibold">${t.displayName} </span>`})} </label> </div> `}renderSelectedTopics(){return j`<div id="selected-topics-container" class="min-h-[32px] h-fit flex flex-wrap justify-start gap-xs"> ${this.filterSelected(this.gqlTopics).map((t=>Y({children:t.displayName,selected:!0,attributes:{type:"button",id:`selected-topic-${t.id}`,className:"bg-neutral-background rounded-1 border-neutral-border",onclick:()=>{this.removeSelected(t.id)}},deleteButtonConfig:{screenReaderContent:`Deselect topic ${t.displayName}`,attributes:{onclick:()=>{this.removeSelected(t.id)},type:"button",id:`unselect-${t.id}`}}})))} </div>`}render(){const t=this._loading?j`<shreddit-loading class="pointer-events-none h-[8rem] mt-4xl"></shreddit-loading>`:this.renderTopics();return j`<div class="w-96 h-16 pr-12 py-2.5 rounded-2xl justify-start items-center pb-xl inline-flex"> <div class="grow shrink basis-0 flex-col justify-center items-start gap-[4px] inline-flex"> <div class="self-stretch text-sm font-normal text-tone-2 leading-tight">${"Add up to 3 topics to help interested redditors find your community."}</div> </div> </div> <faceplate-search-input appearance="${O.SECONDARY}" class="w-full ml-0 mt-sm" type="text" name="filter" @input="${this.handleFilterChange}" value="${this.filter}" placeholder="${"Filter topics"}" novalidate inputmode></faceplate-search-input> <h3 class="w-full flex justify-start text-16 my-xs"> ${e=this.selectedTopics.length.toString(),`Topics ${e}/3 `} </h3> ${this.renderSelectedTopics()} <div data-testid="mature-label-container" class="w-96 text-danger-content min-h-[32px] text-xs font-normal"> ${this.maxTopicsSelected?I({one:`Only ${nt} topic can be added`,other:`Only ${nt} topics can be added`,count:nt}):this.selectedTopics.filter((t=>at.has(t))).length>0?"Selecting Mature topics labels your community as 18+ and limits discovery":""} </div> ${t} <slot></slot> <div class="pt-[40px]"> <slot name="buttons-bar"></slot> </div>`;var e}};dt.styles=[g,N(".bg-rose-100 {\n  background-color: #fceee8;\n}\n.bg-slate-200 {\n  background-color: #e5ebee;\n}\n.fieldset-disabled {\n  opacity: 0.4;\n  pointer-events: none;\n}\n.bg-parent-topic-selected {\n  background-color: #d4c4c4;\n}\n")],m([w()],dt.prototype,"subreddit",void 0),m([w()],dt.prototype,"selectedTopics",void 0),m([w()],dt.prototype,"topics",void 0),m([w()],dt.prototype,"_loading",void 0),m([w()],dt.prototype,"maxTopicsSelected",void 0),dt=m([f("community-creation-topic-selection")],dt);const rt=[{value:E.Public},{value:E.Restricted},{value:E.Private},{adminRequired:!0,value:E.EmployeesOnly}],ht=x(z);let lt=class extends ht{constructor(){super(...arguments),this.events=new S(this,(()=>window)),this.subreddit={type:E.Public,isNSFW:!1},this.isAdmin=!1,this.forceNSFW=!1,this.renderRadioItem=e=>{const i=e.value===this.subreddit.type,{label:s,description:a,icon:n,iconSelected:o}=Z({type:e.value})??{};return j`<label> ${K({onClick:()=>this.subreddit=t(this.subreddit,{type:e.value}),label:s??"",size:G.Medium,attributes:{role:"menuitemradio"},leadingIcon:i?o:n,trailingSlot:j`<faceplate-radio-input class="m-0" @input="${this.typeInputChangeHandler}" ?checked="${i}" name="type" value="${e.value}"></faceplate-radio-input>`,description:a,selected:i})} </label>`}}get _isSubredditNsfw(){return this.subreddit.isNSFW||this.forceNSFW}typeInputChangeHandler(e){const i=e.target.value;this.subreddit=t(this.subreddit,{type:i})}renderTypeInput(){return j` <div class="mb-xs"> <ul role="menu" class="pl-0"> ${rt.map((t=>t.adminRequired&&!this.isAdmin?L:this.renderRadioItem(t)))} </ul> </div> `}async firstUpdated(t){super.firstUpdated(t);for(const t of this.subreddit.topics||[])if(at.has(t.id)){this.forceNSFW=!0;break}await this.updateComplete,this.querySelector("faceplate-pagination-indicator")?.shadowRoot?.querySelectorAll("button.dot").forEach((t=>{t.tabIndex=-1,t.ariaHidden="true"})),this.dispatchEvent(T("refresh_focus",{title:"What kind of community is this?",ariaLabel:"What kind of community is this?. "+e(4)})),this.events.define(i,(async t=>{t.stopPropagation(),this.trackEvent(l(this.subreddit.type.toString())),this.trackEvent(c(this._isSubredditNsfw)),this.dispatchSubredditUpdatedEvent("next")})),this.events.define(a,(async t=>{t.stopPropagation(),this.dispatchSubredditUpdatedEvent("back")}))}dispatchSubredditUpdatedEvent(t){const e=new CustomEvent(n,{bubbles:!0,composed:!0,detail:{subreddit:{...this.subreddit,isNSFW:this._isSubredditNsfw},direction:t,source:o.Type}});this.dispatchEvent(e)}renderNsfwInput(){const e=this._isSubredditNsfw,i=j`<span slot="trigger" class="w-full min-w-100 ${this.forceNSFW?"opacity-75":""}"> ${K({onClick:()=>{this.forceNSFW||(this.subreddit=t(this.subreddit,{isNSFW:!e}))},label:"Mature (18+) ",attributes:{role:"menuitemcheckbox"},size:G.Medium,leadingIcon:e?P():U(),trailingSlot:j` <faceplate-switch-input class="-mr-xs" data-testid="nsfw-input" name="isNsfw" ?checked="${e}" @click="${t=>{this.forceNSFW&&t.preventDefault()}}"> </faceplate-switch-input> `,description:"Users must be over 18 to view and contribute"})} </span>`;return this.forceNSFW?j`<faceplate-tooltip position="bottom-start" appearance="inverted" trigger-event="hover" class="w-full" enter-delay="100"> ${i} ${j`<div class="w-[190px]">${"Community marked as Mature (18+) \n because you selected a mature topic"}</div>`} </faceplate-tooltip>`:i}render(){return j`<div class="min-h-[600px]"> <div class="w-96 h-16 pr-12 py-2.5 rounded-2xl justify-start items-center pb-xl inline-flex"> <div class="grow shrink basis-0 flex-col justify-center items-start gap-[4px] inline-flex"> <div class="self-stretch text-sm font-normal text-tone-2 leading-tight">${j`Decide who can view and contribute in your community. Only public communities show up in search. <strong>Important:</strong> Once set, you will need to submit a request to change your community type.`}</div> </div> </div> ${this.renderTypeInput()} <div class="w-full h-0 border border-black border-opacity-20 mb-sm border-solid"></div> ${this.forceNSFW?j`<div class="w-96 text-danger-content text-xs font-normal"> ${"Community marked as Mature (18+) \n because you selected a mature topic"} </div>`:L} ${this.renderNsfwInput()} <slot name="buttons-bar"></slot> </div>`}};lt.styles=[N("\n    @media (max-width: 400px) {\n      :host {\n        --horizontal-padding: 16px;\n        --topbar-horizontal-padding: 16px;\n        max-height: none;\n        width: 100%;\n        max-width: none;\n        border-radius: 0;\n        margin-top: 20px;\n        padding-bottom: 0;\n        transition: padding-bottom 200ms ease-in-out;\n        z-index: 5;\n        min-height:100vh;\n      }\n    }"),g],m([w()],lt.prototype,"subreddit",void 0),m([v({type:Boolean,attribute:"admin"})],lt.prototype,"isAdmin",void 0),m([w()],lt.prototype,"forceNSFW",void 0),lt=m([f("community-creation-walkthrough-type")],lt);const ct="white",ut="#63f050",pt="black";let gt=class extends z{constructor(){super(...arguments),this.fileName="cropped_image.png",this.canvasClasses="w-100 h-100",this.selectionWidth=100,this.selectionHeight=100,this.keepAspectRatio=!0,this.resizable=!0,this.adjustSelectionToBorder=!1,this._canvasEvents=new S(this,(()=>this.canvas)),this.imageSaved=!1,this.imageToRender=new Image,this.imagePosition={x:0,y:0,width:0,height:0},this.scale=1,this.guide={x:0,y:0,width:0,height:0},this.isDragging=!1,this.resizeCorner="",this.offsetX=0,this.offsetY=0,this.zoomLevel=1,this.maxZoomLevel=3,this.onMouseDown=t=>{const e=this.canvas.getBoundingClientRect();let i,s;t instanceof MouseEvent?(i=t.clientX-e.left,s=t.clientY-e.top):(i=t.touches[0].clientX-e.left,s=t.touches[0].clientY-e.top);if(i>=this.guide.x-8&&i<=this.guide.x+this.guide.width+8&&s>=this.guide.y-8&&s<=this.guide.y+this.guide.height+8){this.offsetX=i-this.guide.x,this.offsetY=s-this.guide.y;const t=16;i>=this.guide.x-t/2&&i<=this.guide.x+t/2&&s>=this.guide.y-t/2&&s<=this.guide.y+t/2?this.resizeCorner="top-left":i>=this.guide.x+this.guide.width-t/2&&i<=this.guide.x+this.guide.width+t/2&&s>=this.guide.y-t/2&&s<=this.guide.y+t/2?this.resizeCorner="top-right":i>=this.guide.x-t/2&&i<=this.guide.x+t/2&&s>=this.guide.y+this.guide.height-t/2&&s<=this.guide.y+this.guide.height+t/2?this.resizeCorner="bottom-left":i>=this.guide.x+this.guide.width-t/2&&i<=this.guide.x+this.guide.width+t/2&&s>=this.guide.y+this.guide.height-t/2&&s<=this.guide.y+this.guide.height+t/2?this.resizeCorner="bottom-right":this.isDragging=!0}},this.onMouseMove=t=>{const e=this.canvas.getBoundingClientRect();let i,s;t instanceof MouseEvent?(i=t.clientX-e.left,s=t.clientY-e.top):(i=t.touches[0].clientX-e.left,s=t.touches[0].clientY-e.top);i>=this.guide.x-8&&i<=this.guide.x+this.guide.width+8&&s>=this.guide.y-8&&s<=this.guide.y+this.guide.height+8?this.canvas.style.cursor="move":this.canvas.style.cursor="default",this.isDragging?this.moveSelectionArea(t):this.resizable&&this.resizeCorner&&this.resizeSelectionArea(t)},this.onMouseUp=()=>{this.isDragging=!1,this.resizeCorner=""},this.handleCancelKeyUp=t=>{"Enter"===t.key&&this.cancelClick()},this.handleSaveKeyUp=t=>{"Enter"===t.key&&this.saveCroppedImage()}}get canvas(){return this.shadowRoot.querySelector("canvas")}drawSelectionArea(t){t.strokeStyle=ct,t.lineWidth=2,t.strokeRect(this.guide.x,this.guide.y,this.guide.width,this.guide.height);t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,this.guide.x,this.canvas.height),t.fillRect(this.guide.x+this.guide.width,0,this.canvas.width-(this.guide.x+this.guide.width),this.canvas.height),t.fillRect(this.guide.x,0,this.guide.width,this.guide.y),t.fillRect(this.guide.x,this.guide.y+this.guide.height,this.guide.width,this.canvas.height-(this.guide.y+this.guide.height))}drawResizeHandles(t){t.fillStyle=ct,t.strokeStyle=pt,t.lineWidth=1,t.fillRect(this.guide.x-4,this.guide.y-4,8,8),t.strokeRect(this.guide.x-4,this.guide.y-4,8,8),t.fillRect(this.guide.x+this.guide.width-4,this.guide.y-4,8,8),t.strokeRect(this.guide.x+this.guide.width-4,this.guide.y-4,8,8),t.fillRect(this.guide.x-4,this.guide.y+this.guide.height-4,8,8),t.strokeRect(this.guide.x-4,this.guide.y+this.guide.height-4,8,8),t.fillStyle=ut,t.strokeStyle=ut,t.fillRect(this.guide.x+this.guide.width-4,this.guide.y+this.guide.height-4,8,8),t.strokeRect(this.guide.x+this.guide.width-4,this.guide.y+this.guide.height-4,8,8)}drawCanvas(){if(this.imgSrc){const t=this.canvas.getContext("2d");if(t){t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle=pt,t.fillRect(0,0,this.canvas.width,this.canvas.height);const e=this.imagePosition.width*this.zoomLevel,i=this.imagePosition.height*this.zoomLevel,s=(this.canvas.width-e)/2,a=(this.canvas.height-i)/2;t.drawImage(this.imageToRender,s,a,e,i),this.drawSelectionArea(t),this.resizable&&this.drawResizeHandles(t)}}}moveSelectionArea(t){const e=this.canvas.getBoundingClientRect();let i,s;t instanceof MouseEvent?(i=t.clientX-e.left,s=t.clientY-e.top):(i=t.touches[0].clientX-e.left,s=t.touches[0].clientY-e.top);let a=i-this.offsetX;a<0?a=0:a+this.guide.width>this.canvas.width&&(a=this.canvas.width-this.guide.width);let n=s-this.offsetY;n<0?n=0:n+this.guide.height>this.canvas.height&&(n=this.canvas.height-this.guide.height),this.guide.x=a,this.guide.y=n,this.drawCanvas()}resizeSelectionArea(t){const e=this.canvas.getBoundingClientRect();let i;i=t instanceof MouseEvent?t.clientX-e.left:t.touches[0].clientX-e.left;const s=30;let a=0,n=0;switch(this.resizeCorner){case"top-left":a=this.guide.width-(i-this.guide.x),a=a>s?a:s,n=a*(this.keepAspectRatio?this.guide.height/this.guide.width:1),this.guide.x=i,this.guide.y+=this.guide.height-n,this.guide.width-=a,this.guide.height=n;break;case"top-right":a=i-this.guide.x,a=a>s?a:s,n=a*(this.keepAspectRatio?this.guide.height/this.guide.width:1),this.guide.y+=this.guide.height-n,this.guide.width=a,this.guide.height=n;break;case"bottom-left":a=this.guide.width-(i-this.guide.x),a=a>s?a:s,n=a*(this.keepAspectRatio?this.guide.height/this.guide.width:1),this.guide.x=i,this.guide.width=a,this.guide.height=n;break;case"bottom-right":a=i-this.guide.x,a=a>s?a:s,n=a*(this.keepAspectRatio?this.guide.height/this.guide.width:1),this.guide.width=a,this.guide.height=n}a>0&&n>0&&(this.guide.width=a,this.guide.height=n,this.drawCanvas())}saveCroppedImage(){const t=1/this.scale,e=document.createElement("canvas"),i=e.getContext("2d");e.width=this.canvas.width*t,e.height=this.canvas.height*t;const s=this.imagePosition.width*t*this.zoomLevel,a=this.imagePosition.height*t*this.zoomLevel,n=(e.width-s)/2,o=(e.height-a)/2;i.drawImage(this.imageToRender,n,o,s,a);const d=this.guide.x*t,r=this.guide.y*t,h=this.guide.width*t,l=this.guide.height*t,c=document.createElement("canvas"),u=c.getContext("2d");c.width=h,c.height=l,u.drawImage(e,d,r,h,l,0,0,h,l),this.imageSaved=!0,c.toBlob((t=>{if(t&&this.onSave){const e=new File([t],this.fileName,{type:"image/png"});this.onSave(e)}}))}zoomIn(){this.zoomLevel<this.maxZoomLevel&&(this.zoomLevel+=.1,this.drawCanvas())}zoomOut(){this.zoomLevel>.5&&(this.zoomLevel-=.1,this.drawCanvas())}resizeImage(){this.scale=Math.min(this.canvas.width/this.imageToRender.width,this.canvas.height/this.imageToRender.height),this.imagePosition.width=this.imageToRender.width*this.scale,this.imagePosition.height=this.imageToRender.height*this.scale,this.imagePosition.x=(this.canvas.width-this.imagePosition.width)/2,this.imagePosition.y=(this.canvas.height-this.imagePosition.height)/2,this.adjustSelectionToBorder&&(this.imagePosition.width<this.imagePosition.height?this.adjustSelectionToWidth():this.adjustSelectionToHeight())}adjustSelectionToWidth(){const t=this.guide.width,e=this.guide.height;this.guide.width=this.imagePosition.width;let i=this.selectionHeight;this.keepAspectRatio&&(i=this.guide.width/this.selectionWidth*this.selectionHeight),i>this.canvas.height&&(i=this.canvas.height-5,this.guide.width=i/this.selectionHeight*this.selectionWidth),this.guide.height=i,this.guide.x=this.guide.x-(this.guide.width-t)/2,this.keepAspectRatio&&(this.guide.y=this.guide.y-(this.guide.height-e)/2)}adjustSelectionToHeight(){const t=this.guide.height,e=this.guide.width;this.guide.height=this.imagePosition.height;let i=this.selectionWidth;this.keepAspectRatio&&(i=this.guide.height/this.selectionHeight*this.selectionWidth),i>this.canvas.width&&(i=this.canvas.width-5,this.guide.height=i/this.selectionWidth*this.selectionHeight),this.guide.width=i,this.guide.y=this.guide.y-(this.guide.height-t)/2,this.keepAspectRatio&&(this.guide.x=this.guide.x-(this.guide.width-e)/2)}addCanvasEventListeners(){this._canvasEvents.define("mousedown",this.onMouseDown),this._canvasEvents.define("mousemove",this.onMouseMove),this._canvasEvents.define("mouseup",this.onMouseUp),this._canvasEvents.define("mouseout",this.onMouseUp),this._canvasEvents.define("touchstart",this.onMouseDown),this._canvasEvents.define("touchmove",this.onMouseMove),this._canvasEvents.define("touchend",this.onMouseUp)}async firstUpdated(){this.addCanvasEventListeners(),this.canvas.width=this.canvas.getBoundingClientRect().width,this.canvas.height=this.canvas.getBoundingClientRect().height,this.guide={x:this.canvas.getBoundingClientRect().width-this.selectionWidth/2,y:(this.canvas.getBoundingClientRect().height-this.selectionHeight)/2,width:this.selectionWidth,height:this.selectionHeight},this.imageToRender.onload=()=>{this.resizeImage(),this.drawCanvas()},this.imageToRender.src=this.imgSrc||""}updated(t){(t.has("selectionWidth")||t.has("selectionHeight"))&&(this.guide.width=parseInt(this.selectionWidth.toString()),this.guide.height=parseInt(this.selectionHeight.toString()),this.guide.x=(this.canvas.getBoundingClientRect().width-parseInt(this.selectionWidth.toString()))/2,this.guide.y=(this.canvas.getBoundingClientRect().height-parseInt(this.selectionHeight.toString()))/2,this.drawCanvas()),super.updated(t)}cancelClick(){this.onCancel&&this.onCancel()}render(){return j` <div class="${this.canvasClasses}"> <div class="p-xs bg-black rounded-1 h-100 w-100" style="${this.canvasWidth?`width:${this.canvasWidth}px; `:""}${this.canvasHeight?`height:${this.canvasHeight}px;`:""}"> <canvas class="w-full h-full inline-block"></canvas> </div> <div class="flex justify-between pt-xs"> <div class="flex justify-start gap-[8px]"> <div class="flex flex-col"> ${b({appearance:"secondary",attributes:{type:"square",onclick:this.zoomOut,"aria-label":"Zoom out"},shape:"square",size:y.Small,leadingIcon:D({size:A.Small})})} </div> <div class="flex flex-col"> ${b({appearance:"secondary",attributes:{type:"button",onclick:this.zoomIn,"aria-label":"Zoom in"},shape:"square",size:y.Small,leadingIcon:M({size:A.Small})})} </div> </div> <div class="flex justify-end"> <div @click="${this.cancelClick}" @keyup="${this.handleCancelKeyUp}"> ${this.cancelButton?this.cancelButton:b({appearance:"secondary",attributes:{id:"image-cropper-cancel-button",className:"ml-sm","data-testid":"submit-button",type:"submit",slot:"primaryButton"},children:"Cancel",size:y.Small})} </div> <div @click="${this.saveCroppedImage}" @keyup="${this.handleSaveKeyUp}"> ${this.saveButton?this.saveButton:b({appearance:"primary",attributes:{id:"image-cropper-save-button",className:"ml-sm","data-testid":"submit-button",type:"submit",slot:"primaryButton"},children:"Save",size:y.Small})} </div> </div> </div> </div> `}};gt.styles=[W`:host{display:block;padding:20px}`,g],m([v({type:String,attribute:"file-name"})],gt.prototype,"fileName",void 0),m([v({type:String,attribute:"canvas-classes"})],gt.prototype,"canvasClasses",void 0),m([v({type:String,attribute:"img-src"})],gt.prototype,"imgSrc",void 0),m([v({type:Number,attribute:"selection-width"})],gt.prototype,"selectionWidth",void 0),m([v({type:Number,attribute:"selection-height"})],gt.prototype,"selectionHeight",void 0),m([v({type:Number})],gt.prototype,"canvasWidth",void 0),m([v({type:Number})],gt.prototype,"canvasHeight",void 0),m([v()],gt.prototype,"cancelButton",void 0),m([v()],gt.prototype,"onCancel",void 0),m([v()],gt.prototype,"saveButton",void 0),m([v()],gt.prototype,"onSave",void 0),m([v({type:Boolean})],gt.prototype,"keepAspectRatio",void 0),m([v({type:Boolean})],gt.prototype,"resizable",void 0),m([v({type:Boolean,attribute:"adjust-selection-to-border"})],gt.prototype,"adjustSelectionToBorder",void 0),m([w()],gt.prototype,"zoomLevel",void 0),m([w()],gt.prototype,"maxZoomLevel",void 0),gt=m([f("image-cropper")],gt);const mt=x(z);let vt=class extends mt{constructor(){super(...arguments),this.events=new S(this,(()=>window)),this.subreddit={},this.editingImage=!1,this.editingImageType="",this.handleAvatarChange=e=>{const i=e.target;this.imageCropperProps={imageSrc:i.src,selectionHeight:300,selectionWidth:300,fileName:i.file.name,onSave:e=>{this.trackEvent(u()),this.editingImage=!1,this.subreddit=t(this.subreddit,{avatar:e})}},this.requestUpdate(),this.editingImage=!0,this.editingImageType="icon"},this.handleBannerChange=e=>{const i=e.target;this.imageCropperProps={imageSrc:i.src,selectionHeight:60,selectionWidth:500,fileName:i.file.name,onSave:e=>{this.trackEvent(p()),this.editingImage=!1,this.subreddit=t(this.subreddit,{banner:e})}},this.requestUpdate(),this.editingImage=!0,this.editingImageType="banner"},this.imagelistElements=[{getLabel:()=>j`${"Banner"}`,getButton:()=>this.getButton(this.handleBannerChange,void 0!==this.subreddit.banner,"Banner"),shouldDisplay:()=>!0,className:"",size:G.Medium},{getLabel:()=>j`<span class="text-12 text-coolgray-550">${this.subreddit.banner?.name||"banner image"}</span>`,getButton:()=>b({appearance:"plain",attributes:{"data-testid":"delete-banner",onclick:()=>{this.subreddit.banner=void 0,this.requestUpdate()},"aria-label":"Delete uploaded banner"},leadingIcon:_({size:A.Small})}),shouldDisplay:()=>void 0!==this.subreddit.banner,className:"border-solid border border-tone-4 rounded-1 overflow-hidden",size:G.Small},{getLabel:()=>j`${"Icon"}`,getButton:()=>this.getButton(this.handleAvatarChange,void 0!==this.subreddit.avatar,"Icon"),shouldDisplay:()=>!0,className:"",size:G.Medium},{getLabel:()=>j`<span class="text-12 text-coolgray-550">${this.subreddit.avatar.name||"avatar image"}}</span>`,getButton:()=>b({appearance:"plain",attributes:{"data-testid":"delete-avatar",onclick:()=>{this.subreddit.avatar=void 0,this.requestUpdate()},"aria-label":"Delete uploaded avatar"},leadingIcon:_({size:A.Small})}),shouldDisplay:()=>void 0!==this.subreddit.avatar,className:"border-solid border border-tone-4 rounded-1 overflow-hidden",size:G.Small}],this.renderElementList=t=>j`<label> ${t.shouldDisplay()?K({hasTransparentBackground:!0,onClick:()=>{},label:t.getLabel(),size:t.size,trailingSlot:t.getButton(),attributes:{className:t.className}}):""} </label>`}async firstUpdated(){await this.updateComplete,this.querySelector("faceplate-pagination-indicator")?.shadowRoot?.querySelectorAll("button.dot").forEach((t=>{t.tabIndex=-1,t.ariaHidden="true"})),this.dispatchEvent(T("refresh_focus",{title:"Style your community",ariaLabel:"Style your community. "+e(2)})),this.events.define(i,(async t=>{t.stopPropagation(),this.dispatchSubredditUpdatedEvent("next")})),this.events.define(a,(async t=>{t.stopPropagation(),this.dispatchSubredditUpdatedEvent("back")}))}dispatchSubredditUpdatedEvent(t){const e=new CustomEvent(n,{bubbles:!0,composed:!0,detail:{subreddit:this.subreddit,direction:t,source:o.Images}});this.dispatchEvent(e)}getButton(t,e,i){return j`<community-image-upload dropzone-classes="border-none" accept="image/x-png,image/jpeg,image/png" @change="${t}" .customContent="${()=>this.renderButton(e?"bordered":"secondary",e?"Change":"Add",i)}"></community-image-upload>`}renderButton(t,e,i){return j`${b({attributes:{"aria-label":e+" "+i},appearance:t,children:e,leadingIcon:F(),size:y.Small})}`}ImageInputs(){return j` <div class="mb-xs min-w-[55%]"> <ul role="menu" class="pl-0"> ${this.imagelistElements.map((t=>this.renderElementList(t)))} </ul> </div> `}render(){const t=j`<div class="min-w-[55%] xs:w-[768px] h-16 pr-12 py-2.5 rounded-2xl justify-start items-center pb-xl inline-flex"> <div class="grow shrink basis-0 flex-col justify-center items-start gap-[4px] inline-flex"> <div class="self-stretch text-sm font-normal text-tone-2 leading-tight w-[80%]"> ${this.editingImage?(e=this.editingImageType,"banner"===e?"Banners must be 1028px x 128px":"Icon must be 1:1"):"Adding visual flair will catch new members attention and help establish your communityâ€™s culture! You can update this at any time."} </div> </div> </div>`;var e;return this.editingImage?j` ${t} <div class="w-100 h-16 pr-12 py-2.5 rounded-2xl justify-start items-center pb-xl inline-flex"> <image-cropper class="max-w-[700px] w-[96%]" canvas-classes="w-100 h-[400px]" img-src="${q(this.imageCropperProps?.imageSrc)}" selection-width="${q(this.imageCropperProps?.selectionWidth)}" selection-height="${q(this.imageCropperProps?.selectionHeight)}" adjust-selection-to-border file-name="${q(this.imageCropperProps?.fileName)}" .onCancel="${()=>{this.editingImage=!1}}" .onSave="${this.imageCropperProps?.onSave}"></image-cropper> </div>`:j` ${t} <div class="flex gap-md flex-col-reverse xs:flex-row"> ${this.ImageInputs()} <div class="flex items-center grow"> <community-creation-preview class="w-100 flex justify-center" name="${q(this.subreddit.name)}" description="${q(this.subreddit.description)}" avatar="${this.subreddit.avatar?URL.createObjectURL(this.subreddit.avatar):""}" banner="${this.subreddit.banner?URL.createObjectURL(this.subreddit.banner):""}" show-default-images></community-creation-preview> </div> </div> <div class="mb-0 pt-[42px]"> <slot name="buttons-bar"></slot> </div> `}};vt.styles=[g],m([w()],vt.prototype,"subreddit",void 0),m([w()],vt.prototype,"editingImage",void 0),m([w()],vt.prototype,"editingImageType",void 0),vt=m([f("community-creation-walkthrough-images")],vt);
